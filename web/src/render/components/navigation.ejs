<header>
    <nav class="vertical">
        <p href="#" class="title"><img src="/assets/img/xeer-black.png" width="32" height="32" style="border-radius: 50%; vertical-align: middle; margin-right: 6px;"> xeer</p>
        <div class="wrapper">
            <p class="section">SELECT GUILD</p>
            <select id="selected_guild" name="Select"></select>
            <p class="section">UTILITIES</p>
            <a href="#welcomer" onclick="goAnotherTab('welcomer')"><span class="material-icons">chat</span> Welcomer</a>
        </div>
    </nav>
</header>
<script>
    const socket = new WebSocket("ws://localhost:443");
    const selector = document.querySelector("#selected_guild");
    socket.addEventListener("message", (data) => {
        try {
            const dJson = JSON.parse(data.data);
            if (!dJson.error) {
                if (dJson.response_to == "GET_USER_GUILDS") {
                    dJson.data.forEach(obj => {
                        const optionObject = document.createElement("option");
                        optionObject.setAttribute("value", obj.id);
                        if (obj.id == "<%= guild_id %>") { optionObject.selected = true; }
                        optionObject.textContent = obj.name;
                        selector.appendChild(optionObject);
                    });
                }
            }
        } catch (e) {}
    });
    socket.addEventListener("open", async (event) => {
        socket.send(JSON.stringify({
            token: "<%= token %>",
            uid: (await getDiscordUser("<%= token %>")).id,
            gids: await getDiscordUserGIDs("<%= token %>"),
            action: "GET_USER_GUILDS"
        }));
    });
    function goAnotherTab(tName) {
        document.location = new URL(`/dashboard/${tName}?gid=${document.querySelector("#selected_guild").value}`, document.location.origin);
    }
</script>